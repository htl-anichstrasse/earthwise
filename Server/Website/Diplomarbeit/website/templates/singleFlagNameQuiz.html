{% extends "base.html" %}
{% block title %}Single Flag Quiz{% endblock %}
{% block content %}

<!-- Stile für die Seite -->
<style>
    .image-container {
        margin: 0px auto;
        padding-left: 350px;
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        grid-template-rows: repeat(1, 1fr);
        gap: 40px;
    }

    .message-container{
        padding-top: 10px;
        text-align: center;
    }

    input{
        width: 400px;
        color: rgb(36, 35, 42);
        font-size: 16px;
        line-height: 20px;
        min-height: 28px;
        border-radius: 2px;
        padding: 8px 16px;
        margin-top: 5px;
        border: 2px solid transparent;
        box-shadow: rgb(0 0 0 / 12%) 0px 1px 3px, rgb(0 0 0 / 24%) 0px 1px 2px;
        background: rgb(251, 251, 251);
        transition: all 0.1s ease 0s;
        :focus{
            border: 2px solid rgb(124, 138, 255);
        }
        margin-left: 41%;
    }
    
</style>

<!-- Quiz-Inhalt -->
<h2 style="text-align: center; margin-top: 20px">{{quiz_name}}</h2>
<h4 style="text-align: center">{{discription}}</h4>
<p style="text-align: center; font-size: 21px">{{session["quiz_count"]}}/5</p>

<!-- Container für Meldungen -->
<div class="message-container">
    <p id="resultMessage" style="display: none;">The right Answer would have been <b>{{land_name}}</b></p>
</div>

<!-- Container für Bilder -->
<div class="image-container">

    <div style="padding-top: 30px;">
        <!-- Anzeige des Quiz-Bildes -->
        <img src="{{ url_for('static', filename= land ) }}" width="400" height="240" style="border: 1px solid black; box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.4);">
    </div>

</div>

<!-- Eingabefeld für Benutzerantwort -->
<input type="text" id="input" onkeydown="handleKeyDown">

<!-- JavaScript-Code für die Quiz-Logik -->
<script>
    // Funktion zum Überprüfen der Benutzereingabe
    function checkInput() {
        var inputElement = document.getElementById('input');
        var resultMessage = document.getElementById('resultMessage');

        inputElement.disabled = true; 
        var answer = "{{land_name}}";
        var input = document.getElementById('input').value;

        var correct_answer = answer.toLowerCase();
        var selectedAnswer = input.toLowerCase();

        // Übermittlung der Benutzerantwort an den Server und Verarbeitung der Antwort
        fetch(`/check_answer/${selectedAnswer}`, { method: 'POST', body: new URLSearchParams({ correct_answer: correct_answer }), headers: { 'Content-Type': 'application/x-www-form-urlencoded' } })
            .then(response => response.json())
            .then(data => {
                
                if (data.is_correct) {
                    resultMessage.style.display = 'block';
                    resultMessage.style.color = 'white';
                    inputElement.disable
                    setTimeout(refreshPage, 3000);
                }
                if (!data.is_correct) {
                    resultMessage.style.display = 'block'; 
                    inputElement.disable
                    setTimeout(refreshPage, 3000);
                }
    
                
    
                // Anzeigen der Anzahl der richtigen Antworten 
                var correctAnswersCountElement = document.getElementById('correctAnswersCount');
                correctAnswersCountElement.innerHTML = `Anzahl der richtigen Antworten: ${data.correct_answers_count}`;
            })
            .catch(error => console.error('Error:', error));
    }

    function handleKeyDown(event) {
        if (event.key === "Enter") {
            checkInput();
        }
    }
    function refreshPage() {
        location.reload();
    }
</script>


{% endblock %}
